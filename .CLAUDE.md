# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

ContentCraft AI is a full-stack application for strategic content creation with AI-powered article generation, SEO optimization, and content planning. The architecture consists of:

1. **Frontend**: Next.js 14 app with Tailwind CSS and Radix UI components
2. **Backend**: FastAPI with SQLAlchemy (async) and PostgreSQL
3. **AI Core**: CrewAI multi-agent system for content generation

## Development Commands

### Frontend (contentcraft-frontend/)
```bash
npm run dev          # Start development server (localhost:3000)
npm run build        # Build for production
npm run start        # Start production server
npm run lint         # Run ESLint
```

### Backend (contentcraft_ai/)
```bash
cd contentcraft_ai
uv install           # Install dependencies (or crewai install)
uvicorn src.contentcraft_ai.api.main_api:app --reload --host 0.0.0.0 --port 8000  # Start API server
crewai run           # Run AI crew (for testing content generation)
python create_tables.py  # Initialize database tables
```

## Architecture Overview

### Frontend Structure
- **App Router**: Next.js 14 with app directory structure
- **Authentication**: JWT tokens stored in localStorage with axios interceptors
- **UI Components**: Custom components in `/src/components/` + Radix UI primitives in `/src/components/ui/`
- **API Integration**: Centralized axios instance in `/src/lib/api.js` pointing to localhost:8000

### Backend Architecture
- **API Layer**: FastAPI with async/await patterns, OAuth2 authentication
- **Database**: SQLAlchemy models with async sessions, PostgreSQL backend
- **AI Core**: CrewAI with 4 specialized agents (researcher, writer, seo_optimizer, seo_scorer)
- **Content Flow**: Pillars → Clusters → Articles (hierarchical content structure)

### AI Agent Workflow
The content generation uses a sequential 4-agent crew:
1. **Researcher**: Analyzes topics and search intent using DuckDuckGo
2. **Writer**: Creates initial article draft based on research brief
3. **SEO Optimizer**: Adds internal links and optimizes content structure
4. **SEO Scorer**: Audits final content and provides SEO score (0-100)

## Key Configuration Files

### Environment Setup
- **Frontend**: No .env required for basic development
- **Backend**: Requires `.env` file with:
  - `OPENAI_API_KEY`, `GROQ_API_KEY`, `GEMINI_API_KEY`
  - Database connection strings
  - JWT secret keys

### AI Configuration
- **Agents**: `contentcraft_ai/src/contentcraft_ai/config/agents.yaml`
- **Tasks**: `contentcraft_ai/src/contentcraft_ai/config/tasks.yaml`
- **Crew Setup**: `contentcraft_ai/src/contentcraft_ai/crew.py`

## Database Schema
- **Users**: Authentication and ownership
- **BrandConfig**: User's brand settings (philosophy, product info)
- **Pillars**: Top-level content categories
- **Clusters**: Grouped content topics within pillars
- **Articles**: Generated content with SEO metrics

## Content Generation Flow
1. User creates pillars and clusters in Strategy Hub
2. Adds article ideas to clusters with intent/keywords
3. Triggers AI generation via `/articles/{id}/generate` endpoint
4. CrewAI processes: research → write → optimize → score
5. Final article saved with content, SEO score, and recommendations

## Common Development Patterns

### Frontend API Calls
All API requests use the configured axios instance from `src/lib/api.js` which automatically adds JWT headers.

### Backend Response Handling
The `/generate` endpoint uses a complex task result extraction pattern to handle CrewAI output objects and extract both raw content and JSON data.

### Component Conventions
- Use Tailwind for styling with predefined color scheme (blue primary: #3B82F6)
- Radix UI for interactive components
- Lucide React for icons
- Status indicators follow: Idea → In Progress → Completed → Edited

## Testing & Quality
- Frontend linting available via `npm run lint`
- Backend uses async SQLAlchemy patterns
- AI agents use multiple LLM providers (Groq, Gemini) for redundancy

## Content Strategy
The app implements a pillar-cluster content model where internal linking prioritizes: same cluster > sibling cluster > pillar overview > cross-pillar relevance.